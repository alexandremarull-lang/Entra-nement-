<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GamePlan ‚Äì Entra√Ænements (Semaine)</title>
  <style>
    :root { --gold:#d4af37; --black:#0f1115; --muted:#a9a9b3; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;background:linear-gradient(180deg,var(--black),#131622);color:#fff}
    header{position:sticky;top:0;z-index:40;background:rgba(15,17,21,.8);backdrop-filter:blur(10px);border-bottom:1px solid #1f2333}
    .wrap{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:36px;height:36px;border-radius:8px;background:radial-gradient(circle at 30% 30%,var(--gold),#7a5c14);box-shadow:0 0 0 2px rgba(212,175,55,.25)}
    h1{font-size:clamp(18px,2.5vw,22px);margin:0;font-weight:700;letter-spacing:.3px}
    .subtitle{color:var(--muted);margin:4px 0 0;font-size:13px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    button,.btn{appearance:none;border:1px solid #2a2f44;color:#fff;background:#171a26;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;transition:.2s ease;font-size:14px}
    button:hover,.btn:hover{transform:translateY(-1px);border-color:#3a3f58}
    .btn-gold{background:linear-gradient(180deg,#b9952a,var(--gold));color:#0c0f17;border:none}
    .btn-ghost{background:transparent;border-color:#353a54;color:#c9ccdb}

    main{max-width:1100px;margin:18px auto;padding:0 16px 80px}
    .grid{display:grid;gap:14px;grid-template-columns:repeat(5,minmax(0,1fr))}
    @media(max-width:980px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    @media(max-width:640px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}

    .tile{position:relative;background:radial-gradient(120% 120% at 100% 0%,#1a1f33 0%,#111424 45%,#0d101a 100%);border:1px solid #1f2540;border-radius:16px;padding:14px;min-height:170px;display:flex;flex-direction:column;justify-content:space-between;gap:8px;cursor:pointer;overflow:hidden}
    .tile:hover{box-shadow:0 8px 24px rgba(0,0,0,.35),inset 0 0 0 1px #2d355a}
    .tile h3{margin:0;font-size:18px;letter-spacing:.3px}
    .packs{display:flex;flex-wrap:wrap;gap:6px}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;font-size:12px;background:#141829;border:1px solid #283050;color:#cbd2ff}
    .count{color:var(--muted);font-size:12px}
    .footer-note{color:#9aa1b6;font-size:12px;margin-top:14px}

    /* Images de fond */
    .tile .bg{position:absolute;inset:0;background-size:cover;background-position:center;opacity:.25;filter:saturate(0.9) contrast(1.05) brightness(.85);transition:transform .35s ease,opacity .2s ease}
    .tile:hover .bg{transform:scale(1.05);opacity:.32}
    .tile .shade{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.15),rgba(0,0,0,.45));}
    .tile .content{position:relative;z-index:1}

    /* Drawer coach */
    .drawer{position:fixed;right:0;top:0;bottom:0;width:min(460px,92vw);background:#0e121d;border-left:1px solid #242b44;transform:translateX(100%);transition:transform .25s ease;z-index:50;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0)}
    .drawer header{position:sticky;top:0;border-bottom:1px solid #1f2742;padding:14px 16px;background:#0f1422}
    .drawer .body{padding:12px 16px;overflow:auto}
    .field{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
    label{font-size:13px;color:#b7bdd0}
    select,input[type="text"],input[type="password"],input[type="url"],textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2b3150;background:#12172a;color:#e3e6f0;font-size:14px}
    textarea{min-height:64px;resize:vertical}
    .list{display:flex;flex-direction:column;gap:10px}
    .chip{background:#151a2b;border:1px solid #2a3151;padding:8px 10px;border-radius:10px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .muted{color:#9aa1b6;font-size:12px}
    .divider{height:1px;background:#222840;margin:12px 0}
    dialog{border:1px solid #293053;border-radius:16px;padding:0;background:#0f1422;color:#fff;width:min(720px,92vw)}
    dialog::backdrop{background:rgba(4,7,15,.65);backdrop-filter:blur(2px)}
    .modal-head{padding:14px 16px;border-bottom:1px solid #1f2742;display:flex;align-items:center;justify-content:space-between}
    .modal-body{padding:14px 16px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 9px;border-radius:999px;font-size:12px;background:#141829;border:1px solid #283050;color:#cbd2ff}
    .files{display:flex;flex-direction:column;gap:8px}
    .file{background:#141829;border:1px solid #232a49;border-radius:10px;padding:8px 10px;display:flex;justify-content:space-between;align-items:center;gap:10px}
    a.link{color:#cfd6ff;text-decoration:underline;text-decoration-thickness:1px}
    .hidden{display:none!important}

    /* Dropdown exercices par pack */
    details.exo-dd{border:1px solid #2a3151;border-radius:10px}
    details.exo-dd>summary{list-style:none;padding:10px 12px;cursor:pointer}
    details.exo-dd[open]>summary{border-bottom:1px solid #2a3151}
    .exo-list{padding:8px 12px;display:grid;grid-template-columns:1fr;gap:6px}
    .exo-list label{display:flex;align-items:center;gap:8px}

    /* Preview image tuile */
    .thumb-preview{width:100%;height:120px;object-fit:cover;border-radius:10px;border:1px solid #2a3151}

    /* Bouton coach flottant (visible en mode joueur) */
    .float-coach{position:fixed;right:16px;bottom:16px;z-index:60}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>GamePlan ‚Äì Semaine d'entra√Ænements</h1>
          <div class="subtitle">5 tuiles ¬∑ simple √† partager ¬∑ fiches PDF/HTML cliquables</div>
        </div>
      </div>
      <div class="actions">
        <button id="btnModeJoueur" class="btn-ghost" title="Masque les contr√¥les coach pour partager">Mode joueur</button>
        <button id="btnCoach" class="btn-gold" title="Ouvrir l'espace coach">Espace coach</button>
      </div>
    </div>
  </header>

  <main>
    <section class="grid" id="grid"></section>
    <p class="footer-note">Astuce : cliquez une tuile pour voir le d√©tail du jour. ‚Äî Code coach : <b></b>. Lien joueurs : ajoutez <code>?mode=joueur</code>. Param√®tre d'√©quipe : <code>?team=...</code> (d√©faut <code>equipe1</code>).</p>
    <div class="divider"></div>
    <details>
      <summary>üì¶ Packs disponibles</summary>
      <p class="subtitle">Choisissez un pack puis ouvrez le menu pour s√©lectionner pr√©cis√©ment les exercices.</p>
      <div id="packsPreview" class="packs"></div>
    </details>
  </main>

  <!-- Bouton flottant "Coach" visible en mode joueur -->
  <button id="btnCoachReturn" class="btn-gold float-coach hidden" title="Acc√©der √† l'espace coach">Coach</button>

  <!-- Modal d√©tail jour -->
  <dialog id="dayModal">
    <div class="modal-head"><strong id="modalTitle">D√©tail du jour</strong><div><button class="btn-ghost" onclick="dayModal.close()">Fermer</button></div></div>
    <div class="modal-body">
      <div class="packs" id="modalPacks"></div>
      <div class="divider"></div>
      <h4>Exercices</h4>
      <ol id="modalExercises"></ol>
      <div class="divider"></div>
      <h4>Fichiers & liens</h4>
      <div class="files" id="modalFiles"></div>
    </div>
  </dialog>

  <!-- Drawer / Espace coach -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <header>
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
        <h2>‚öôÔ∏è Espace coach</h2>
        <div style="display:flex;gap:8px;">
          <button id="btnExport" class="btn">Exporter</button>
          <label class="btn-ghost" style="cursor:pointer;">Importer JSON<input id="importInput" type="file" accept="application/json" style="display:none"></label>
          <button id="btnCloseDrawer" class="btn-ghost">Fermer</button>
        </div>
      </div>
    </header>
    <div class="body">
      <div id="loginBox" class="">
        <div class="field"><label>Code coach</label><input type="password" id="loginCode" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" /></div>
        <div style="display:flex; gap:8px;"><button id="btnLogin" class="btn-gold">Se connecter</button></div>
        <p class="muted">Code fixe : <b>0802</b>.</p>
      </div>

      <div id="coachForm" class="hidden">
        <div class="field">
          <label>Jour √† √©diter</label>
          <select id="daySelect"></select>
        </div>

        <div class="field">
          <label>Image de la tuile</label>
          <img id="thumbPreview" class="thumb-preview" alt="Pr√©visualisation image du jour">
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
            <input type="file" id="thumbFile" accept="image/*" />
            <input type="url" id="thumbUrl" placeholder="Ou collez l'URL d'une image (Drive, web)‚Ä¶" />
            <button id="btnSetThumb" class="btn">D√©finir</button>
            <button id="btnClearThumb" class="btn-ghost">Retirer</button>
          </div>
          <div class="muted">Astuce : un fichier local utilisera une URL temporaire (visible uniquement sur cet appareil). Pr√©f√©rez une URL publique pour partager.</div>
        </div>

        <div class="field">
          <label>Packs & exercices (menu d√©roulant)</label>
          <div id="packsList" class="list"></div>
        </div>

        <div class="field">
          <label>Exercices suppl√©mentaires (un par ligne)</label>
          <textarea id="extraExercises" placeholder="Ex: √âchelles de rythme, concours de lancers-francs 3' ..."></textarea>
        </div>

        <div class="field">
          <label>Ajouter un fichier (PDF/HTML/JPG‚Ä¶)</label>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <input type="file" id="fileInput" />
            <input type="url" id="urlInput" placeholder="Ou collez une URL (Drive, YouTube, site)‚Ä¶" />
            <button id="btnAddFile" class="btn">Ajouter</button>
          </div>
          <div class="muted">Les fichiers import√©s sont locaux (URL temporaire). Pour partager, utilisez des liens (Drive, etc.).</div>
        </div>

        <div class="field">
          <label>Pi√®ces jointes du jour</label>
          <div id="attachments" class="list"></div>
        </div>

        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button id="btnSave" class="btn-gold">üíæ Enregistrer le jour</button>
          <button id="btnResetDay" class="btn-ghost">‚ôªÔ∏è Vider le jour</button>
          <button id="btnResetWeek" class="btn-ghost">üóëÔ∏è R√©initialiser la semaine</button>
        </div>
      </div>
    </div>
  </aside>

  <script>
    // ---------- Donn√©es packs / jours ----------
    const PACKS = {
      'Cardio üèÉ‚Äç‚ôÇÔ∏è': ['Footing 10‚Ä≤ + mobilit√©','HIIT 6√ó(30‚Ä≥/30‚Ä≥) lignes','17s + suicides (2 s√©ries)','3√ó(shuttle run 5-10-5)'],
      'R√©activit√© ‚ö°': ['√âchelles de rythme (4 ateliers)','R√©activit√© sifflet: d√©parts al√©atoires','Close-out & slides (2√ó4‚Ä≤)','Catch-and-shoot 0.5s'],
      'Mixte üîÅ': ['Transition 3c2/2c1','Rebond + outlet + finition','Pick&roll lecture (3 variantes)','Concours LF & 3pts (3‚Ä≤)'],
      'Musculation üèãÔ∏è‚Äç‚ôÇÔ∏è': ['Circuit 6 postes (45‚Ä≥/15‚Ä≥ √ó 3 tours)','Tractions / pompes / dips','Fentes saut√©es 3√ó10','Med ball: lancers rotatoires'],
      'Gainage üß±': ['Planche 3√ó45‚Ä≥','Side plank 3√ó30‚Ä≥/c√¥t√©','Hollow/arch hold 3√ó20‚Ä≥','Farmer walk 3√ó20m']
    };
    const DAYS = ['Lundi','Mardi','Mercredi','Jeudi','Vendredi'];
    const LS_KEY = 'gameplan_week_v1';

    const DEFAULT_THUMBS = {
      'Lundi': 'https://images.unsplash.com/photo-1546519638-68e109498ffc?q=80&w=1200&auto=format&fit=crop',
      'Mardi': 'https://i.postimg.cc/t4z0jJJF/pexels-jean-daniel-4562470.jpg',
      'Mercredi': 'https://i.postimg.cc/QMSf6Wtn/vecteezy-basketball-silhouette-aesthetic-21821692.jpg',
      'Jeudi': 'https://i.postimg.cc/4Nqk5qMh/pexels-antonio-filigno-159809-538694.jpg',
      'Vendredi': 'https://i.postimg.cc/sgY6hLRz/pexels-spencerlind1-1331750.jpg'
    };

    function defaultWeek(){
      const obj = {};
      DAYS.forEach(d=> obj[d] = { packs: [], exercises: [], files: [], thumb: '' });
      return obj;
    }
    let week = loadWeek();
    function loadWeek(){
      try{
        const w = JSON.parse(localStorage.getItem(LS_KEY)) || defaultWeek();
        DAYS.forEach(d=>{ if(!w[d].hasOwnProperty('thumb')) w[d].thumb=''; });
        return w;
      }catch{ return defaultWeek(); }
    }
    function saveWeek(){ localStorage.setItem(LS_KEY, JSON.stringify(week)); render(); }

    const grid = document.getElementById('grid');
    const packsPreview = document.getElementById('packsPreview');

    function render(){
      grid.innerHTML = '';
      DAYS.forEach(day=>{
        const data = week[day];
        const img = data.thumb || DEFAULT_THUMBS[day] || '';
        const tile = document.createElement('article');
        tile.className = 'tile';
        tile.innerHTML = `
          <div class="bg" style="background-image:url('${img}')"></div>
          <div class="shade"></div>
          <div class="content">
            <div>
              <h3>${day}</h3>
              <div class="packs">${data.packs.map(p=>`<span class='tag'>${p}</span>`).join('') || `<span class='count'>Aucun pack</span>`}</div>
            </div>
            <div><div class="count">${data.exercises.length} exos ¬∑ ${data.files.length} fichier(s)</div></div>
          </div>`;
        tile.addEventListener('click',()=> openDayModal(day));
        grid.appendChild(tile);
      });
      packsPreview.innerHTML = Object.keys(PACKS).map(p=>`<span class='pill'>${p}</span>`).join(' ');
      daySelect.innerHTML = DAYS.map(d=>`<option>${d}</option>`).join('');
      buildPacksUI();
      daySelect.dispatchEvent(new Event('change'));
    }

    // ---------- Modal d√©tail du jour ----------
    const dayModal = document.getElementById('dayModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalPacks = document.getElementById('modalPacks');
    const modalExercises = document.getElementById('modalExercises');
    const modalFiles = document.getElementById('modalFiles');
    function openDayModal(day){
      const data = week[day];
      modalTitle.textContent = day;
      modalPacks.innerHTML = data.packs.map(p=>`<span class='pill'>${p}</span>`).join('') || '<span class="muted">Aucun pack</span>';
      modalExercises.innerHTML = (data.exercises.length ? data.exercises : ['Aucun exercice']).map(e=>`<li>${escapeHtml(e)}</li>`).join('');
      modalFiles.innerHTML = (data.files.length ? data.files.map((f,i)=> fileRow(f,i,false)).join('') : '<div class="muted">Aucun fichier</div>');
      dayModal.showModal();
    }
    function fileRow(file, idx, withActions){
      const name = escapeHtml(file.name || 'Pi√®ce jointe');
      const url = file.url; const type = file.type || '';
      return `<div class="file"><div><div><a class="link" href="${url}" target="_blank" rel="noopener">${name}</a></div><small class="muted">${type}</small></div>${withActions?`<button class='btn-ghost' data-action='delFile' data-index='${idx}'>Supprimer</button>`:''}</div>`;
    }

    // ---------- Drawer + login 0802 ----------
    const drawer = document.getElementById('drawer');
    const btnCoach = document.getElementById('btnCoach');
    const btnCoachReturn = document.getElementById('btnCoachReturn');
    const btnCloseDrawer = document.getElementById('btnCloseDrawer');
    const loginBox = document.getElementById('loginBox');
    const coachForm = document.getElementById('coachForm');
    const loginCode = document.getElementById('loginCode');
    const btnLogin = document.getElementById('btnLogin');

    function openCoachDrawer(){
      drawer.classList.add('open');
      coachForm.classList.add('hidden');
      loginBox.classList.remove('hidden');
      loginCode.value='';
    }
    btnCoach.addEventListener('click', openCoachDrawer);
    btnCoachReturn.addEventListener('click', openCoachDrawer);
    btnCloseDrawer.addEventListener('click',()=> drawer.classList.remove('open'));
    btnLogin.addEventListener('click',()=>{ if(loginCode.value==='0802'){ coachForm.classList.remove('hidden'); loginBox.classList.add('hidden'); } else { alert('Code incorrect.'); } });

    // ---------- Contr√¥les coach ----------
    const daySelect = document.getElementById('daySelect');
    const packsList = document.getElementById('packsList');
    const extraExercises = document.getElementById('extraExercises');
    const attachments = document.getElementById('attachments');
    const fileInput = document.getElementById('fileInput');
    const urlInput = document.getElementById('urlInput');

    const thumbPreview = document.getElementById('thumbPreview');
    const thumbFile = document.getElementById('thumbFile');
    const thumbUrl = document.getElementById('thumbUrl');
    const btnSetThumb = document.getElementById('btnSetThumb');
    const btnClearThumb = document.getElementById('btnClearThumb');

    function buildPacksUI(){
      packsList.innerHTML = '';
      Object.entries(PACKS).forEach(([packName, exos])=>{
        const block = document.createElement('div');
        block.className = 'pack-block';
        const id = 'pack_'+packName.replace(/\W+/g,'');
        block.innerHTML = `
          <label class="chip"><span>${packName}</span>
            <input type='checkbox' id='${id}' style='accent-color: var(--gold); transform: scale(1.2);'>
          </label>
          <details class='exo-dd' data-pack='${packName}'>
            <summary>Choisir les exercices</summary>
            <div class='exo-list'>
              ${exos.map((e)=>`<label><input type='checkbox' data-exo='${escapeHtml(e)}' checked> ${escapeHtml(e)}</label>`).join('')}
            </div>
          </details>
        `;
        packsList.appendChild(block);
        const master = block.querySelector('#'+id);
        const dd = block.querySelector('details');
        const exoCbs = Array.from(block.querySelectorAll("input[type='checkbox'][data-exo]"));
        master.addEventListener('change',()=>{ if(master.checked){ dd.open = true; exoCbs.forEach(cb=> cb.checked = true); } else { exoCbs.forEach(cb=> cb.checked = false); } });
      });
    }

    function renderAttachments(){
      const d = daySelect.value || DAYS[0];
      const list = week[d].files || [];
      attachments.innerHTML = list.map((f,i)=> fileRow(f,i,true)).join('') || '<div class="muted">Aucun fichier</div>';
      attachments.querySelectorAll('button[data-action="delFile"]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const idx = +e.currentTarget.dataset.index;
          week[d].files.splice(idx,1);
          saveWeek();
          if (window.saveToCloud) saveToCloud();
          renderAttachments();
        });
      });
    }

    // ---------- Images tuiles ----------
    btnSetThumb.addEventListener('click', ()=>{
      const d = daySelect.value || DAYS[0];
      if (thumbFile.files && thumbFile.files[0]){
        const f = thumbFile.files[0];
        week[d].thumb = URL.createObjectURL(f); // local (pr√©f√©rez une URL publique)
        thumbFile.value = '';
      } else if (thumbUrl.value){
        week[d].thumb = thumbUrl.value.trim();
        thumbUrl.value = '';
      } else { return alert("Ajoutez un fichier image ou une URL."); }
      saveWeek();
      if (window.saveToCloud) saveToCloud();
      updateThumbPreview();
    });
    btnClearThumb.addEventListener('click', ()=>{
      const d = daySelect.value || DAYS[0];
      week[d].thumb = '';
      saveWeek();
      if (window.saveToCloud) saveToCloud();
      updateThumbPreview();
    });
    function updateThumbPreview(){
      const d = daySelect.value || DAYS[0];
      const src = week[d].thumb || DEFAULT_THUMBS[d] || '';
      thumbPreview.src = src; thumbPreview.alt = 'Image '+d;
    }

    // ---------- Changement de jour ----------
    daySelect.addEventListener('change', ()=>{
      const d = daySelect.value; const data = week[d];
      // Packs/exos UI
      packsList.querySelectorAll('.pack-block').forEach(block=>{
        const name = block.querySelector('.chip span').textContent;
        const master = block.querySelector(".chip input[type='checkbox']");
        const exoCbs = Array.from(block.querySelectorAll("input[type='checkbox'][data-exo]"));
        const selectedInPack = (data.exercises||[]).filter(x=> (PACKS[name]||[]).includes(x));
        master.checked = data.packs.includes(name);
        exoCbs.forEach(cb=>{ cb.checked = selectedInPack.includes(cb.dataset.exo) || master.checked; });
        block.querySelector('details').open = master.checked;
      });
      // Extra
      const packExos = data.packs.flatMap(p=> PACKS[p]||[]);
      extraExercises.value = (data.exercises.filter(e=> !packExos.includes(e))).join('\n');
      // Fichiers
      renderAttachments();
      // Image preview
      updateThumbPreview();
    });

    // ---------- Fichiers ----------
    document.getElementById('btnAddFile').addEventListener('click', ()=>{
      const d = daySelect.value || DAYS[0];
      if (fileInput.files && fileInput.files[0]){
        const f = fileInput.files[0];
        const url = URL.createObjectURL(f);
        week[d].files.push({ name: f.name, url, type: f.type || 'fichier local' });
        fileInput.value = '';
      } else if (urlInput.value){
        week[d].files.push({ name: new URL(urlInput.value).hostname, url: urlInput.value, type: 'lien' });
        urlInput.value='';
      } else { return alert('Ajoutez un fichier ou une URL.'); }
      saveWeek();
      if (window.saveToCloud) saveToCloud();
      renderAttachments();
    });

    // ---------- Enregistrer / Reset ----------
    document.getElementById('btnSave').addEventListener('click', async ()=>{
      const d = daySelect.value || DAYS[0];
      const selectedPacks = Array.from(packsList.querySelectorAll('.pack-block'))
        .filter(block=> block.querySelector(".chip input[type='checkbox']").checked)
        .map(block=> block.querySelector('.chip span').textContent);

      const selectedPackExercises = Array.from(packsList.querySelectorAll('.pack-block')).flatMap(block=>{
        const masterChecked = block.querySelector(".chip input[type='checkbox']").checked;
        if(!masterChecked) return [];
        return Array.from(block.querySelectorAll("input[type='checkbox'][data-exo]:checked")).map(cb=> cb.dataset.exo);
      });

      const extra = extraExercises.value.split(/\n+/).map(s=> s.trim()).filter(Boolean);
      const merged = [...new Set([...selectedPackExercises, ...extra])];

      week[d].packs = selectedPacks;
      week[d].exercises = merged;

      saveWeek();
      if (window.saveToCloud) await saveToCloud();
      alert('Jour enregistr√©.');
    });

    document.getElementById('btnResetDay').addEventListener('click', async ()=>{
      const d = daySelect.value || DAYS[0];
      if(confirm('Vider toutes les donn√©es de '+d+' ?')){
        week[d] = { packs: [], exercises: [], files: [], thumb: '' };
        saveWeek();
        daySelect.dispatchEvent(new Event('change'));
        if (window.saveToCloud) await saveToCloud();
      }
    });

    document.getElementById('btnResetWeek').addEventListener('click', async ()=>{
      if(confirm('R√©initialiser toute la semaine ?')){
        week = defaultWeek();
        saveWeek();
        daySelect.dispatchEvent(new Event('change'));
        if (window.saveToCloud) await saveToCloud();
      }
    });

    // ---------- Import / Export ----------
    document.getElementById('btnExport').addEventListener('click', ()=>{
      const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(week, null, 2));
      const a = document.createElement('a'); a.href = dataStr; a.download = 'gameplan_semaine.json'; a.click();
    });
    document.getElementById('importInput').addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = async () => {
        try {
          week = JSON.parse(reader.result);
          DAYS.forEach(d=>{ if(!week[d].hasOwnProperty('thumb')) week[d].thumb=''; });
          saveWeek();
          if (window.saveToCloud) await saveToCloud();
          alert('Import r√©ussi.');
        } catch {
          alert('Fichier invalide.');
        }
      };
      reader.readAsText(file); e.target.value = '';
    });

    // ---------- Mode joueur + bouton coach flottant ----------
    const btnModeJoueur = document.getElementById('btnModeJoueur');
    function applyPlayerMode(){
      const urlParams = new URLSearchParams(location.search);
      const isPlayer = urlParams.get('mode') === 'joueur' || sessionStorage.getItem('playerMode') === '1';
      document.querySelector('.actions').classList.toggle('hidden', isPlayer);
      document.getElementById('btnCoachReturn').classList.toggle('hidden', !isPlayer);
      btnModeJoueur.textContent = isPlayer ? 'Quitter mode joueur' : 'Mode joueur';
    }
    btnModeJoueur.addEventListener('click', ()=>{
      const isPlayer = sessionStorage.getItem('playerMode') === '1';
      sessionStorage.setItem('playerMode', isPlayer ? '0':'1');
      applyPlayerMode();
    });

    function escapeHtml(s){
      return (s||'').replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]) );
    }

    render();
    applyPlayerMode();
  </script>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // Config Firebase (fournie)
    const firebaseConfig = {
      apiKey: "AIzaSyCl7sTGRx268BYIHgZnw6J0hOBP27SceJE",
      authDomain: "entr-asptt.firebaseapp.com",
      databaseURL: "https://entr-asptt-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "entr-asptt",
      storageBucket: "entr-asptt.firebasestorage.app",
      messagingSenderId: "808590546319",
      appId: "1:808590546319:web:9f97e735ceed279f6767fa",
      measurementId: "G-P7Z3GXG64D"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // √âquipe (param√®tre d'URL ?team=...)
    const TEAM = new URLSearchParams(location.search).get('team') || 'equipe1';

    // Lecture temps r√©el (joueurs & coach)
    function startRealtimeSync() {
      firebase.database().ref('teams/'+TEAM+'/week').on('value', (snap) => {
        const cloud = snap.val();
        if (cloud) {
          window.week = cloud;
          try { localStorage.setItem('gameplan_week_v1', JSON.stringify(window.week)); } catch(e) {}
          if (typeof render === 'function') render();
        }
      });
    }

    // √âcriture (appel√©e apr√®s chaque saveWeek)
    function saveToCloud(){
      return firebase.database().ref('teams/'+TEAM+'/week').set(window.week);
    }
    window.saveToCloud = saveToCloud;

    startRealtimeSync();
  </script>
</body>
</html>